name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install dependencies
        working-directory: frontend
        run: |
          npm install

      - name: Build project
        working-directory: frontend
        run: |
          # ✅ Test si le build fonctionne
          echo "=== Test du build ==="
          npm run build
          
          # ✅ Vérification que le build a créé les fichiers
          echo "=== Fichiers après build ==="
          ls -la dist/

      - name: Create 404.html for SPA
        working-directory: frontend
        run: |
          # ✅ Crée 404.html à partir du index.html généré
          echo "=== Création de 404.html ==="
          cp dist/index.html dist/404.html
          
          # ✅ Vérification
          echo "=== Vérification de 404.html ==="
          ls -la dist/404.html
          echo "✅ 404.html créé avec succès"

          # ✅ Crée .nojekyll
          touch dist/.nojekyll
          echo "✅ .nojekyll créé"

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: frontend/dist

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4